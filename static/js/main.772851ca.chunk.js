(this["webpackJsonpopencv-facial-recognition"]=this["webpackJsonpopencv-facial-recognition"]||[]).push([[0],{15:function(e,t,r){},17:function(e,t,r){},19:function(e,t,r){"use strict";r.r(t);var i,n=r(3),a=r.n(n),s=r(10),o=r.n(s),c=(r(15),r(0)),d=r.n(c),h=r(1),u=r(4),_=r(5),l=r(8),p=r(7),v=(r(17),r(6));function f(){return(f=Object(h.a)(d.a.mark((function e(t,r){var i,n,a,s,o,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i="",n="",a="","","","",t instanceof Object){e.next=8;break}throw new Error("The first input should be a object that points the path to the OpenCV.js");case 8:if("asm"in t&&(n=t.asm),"wasm"in t&&(a=t.wasm),"threads"in t&&t.threads,"simd"in t&&t.simd,"threadsSimd"in t&&t.threadsSimd,(s=!("undefined"===typeof WebAssembly))||""!==i||""==n){e.next=19;break}i=n,console.log("The OpenCV.js for Asm.js is loaded now"),e.next=21;break;case 19:if(s||""!=n){e.next=21;break}throw new Error("The browser supports the Asm.js only, but the path of OpenCV.js for Asm.js is empty");case 21:if(!1,!1,s&&""!=a?(i=a,console.log("The OpenCV.js for wasm is loaded now")):s&&console.log("The browser supports wasm, but the path of OpenCV.js for wasm is empty"),""!==i){e.next=26;break}throw new Error("No available OpenCV.js, please check your paths");case 26:(o=document.createElement("script")).setAttribute("async",""),o.setAttribute("type","text/javascript"),o.addEventListener("load",(function(){r()})),o.addEventListener("error",(function(){console.log("Failed to load opencv.js")})),o.src=i,(c=document.getElementsByTagName("script")[0]).src!=i&&c.parentNode.insertBefore(o,c);case 34:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(e){e[e.ready=0]="ready",e[e.error=1]="error",e[e.found=2]="found"}(i||(i={}));var b=function(e){Object(l.a)(r,e);var t=Object(p.a)(r);function r(e,i){var n;return Object(u.a)(this,r),(n=t.call(this))._output_render_context=void 0,n._video=void 0,n._stream=new MediaStream,n._is_scanning=!1,n._anim_id=0,n._interval_id=0,n.src=void 0,n.grey=void 0,n.faces=void 0,n.eyes=void 0,n.border_width=void 0,n.border_colour=void 0,n.position=void 0,n.worker=void 0,n._output_render_context=e,n.border_width=i.border_width,n.border_colour=i.border_colour,n.position={},n._video=document.createElement("video"),n._output_render_context.fillStyle="black",n._output_render_context.fillRect(0,0,n._output_render_context.canvas.width,n._output_render_context.canvas.height),window.Worker&&(n.worker=new Worker("./worker.js"),n.worker.onmessage=function(e){this.position=e.data.position,this._callbacks.found&&(this.position.face||this.position.eyes)&&this._callbacks.found(e.data)}.bind(Object(v.a)(n))),n}return Object(_.a)(r,[{key:"_read",value:function(){var e=Object(h.a)(d.a.mark((function e(){var t,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._callbacks.found&&(r=this._output_render_context.getImageData(0,0,this._output_render_context.canvas.width,this._output_render_context.canvas.height),null===(t=this.worker)||void 0===t||t.postMessage([r])),this._is_scanning?this._interval_id=window.setTimeout(this._read.bind(this),80):clearTimeout(this._interval_id);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_render",value:function(){var e=Object(h.a)(d.a.mark((function e(){var t,r,i,n,a,s,o,c,h,u,_,l,p=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={width:this._output_render_context.canvas.width/this._video.videoWidth,height:this._output_render_context.canvas.height/this._video.videoHeight},r=Math.max(t.width,t.height),i=this._video.videoWidth*r,n=this._video.videoHeight*r,a=this._output_render_context.canvas.width/2-this._video.videoWidth/2*r,s=this._output_render_context.canvas.height/2-this._video.videoHeight/2*r,this._output_render_context.drawImage(this._video,a,s,i,n),this.position.face&&(this._output_render_context.beginPath(),this._output_render_context.lineWidth=this.border_width,this._output_render_context.strokeStyle=this.border_colour,this._output_render_context.rect(null===(o=this.position.face)||void 0===o?void 0:o.topLeft.x,null===(c=this.position.face)||void 0===c?void 0:c.topLeft.y,(null===(h=this.position.face)||void 0===h?void 0:h.bottomRight.x)-(null===(u=this.position.face)||void 0===u?void 0:u.topLeft.x),(null===(_=this.position.face)||void 0===_?void 0:_.bottomRight.y)-(null===(l=this.position.face)||void 0===l?void 0:l.topLeft.y)),this._output_render_context.stroke()),this.position.eyes&&this.position.eyes.forEach((function(e){p._output_render_context.beginPath(),p._output_render_context.lineWidth=p.border_width,p._output_render_context.strokeStyle="blue",p._output_render_context.rect(e.topLeft.x,e.topLeft.y,e.bottomRight.x-e.topLeft.x,e.bottomRight.y-e.topLeft.y),p._output_render_context.stroke()})),this._is_scanning?this._anim_id=window.requestAnimationFrame(this._render.bind(this)):window.cancelAnimationFrame(this._anim_id);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"print",value:function(e,t,r,i){var n=this._output_render_context.canvas.getBoundingClientRect().width,a=e.split(" "),s="";this._output_render_context.font="20px Arial",this._output_render_context.fillStyle="white",this._output_render_context.textAlign="center";for(var o=0;o<a.length;o++){var c=s+a[o]+" ";this._output_render_context.measureText(c).width>n&&o>0?(this._output_render_context.fillText(s,t,r),s=a[o]+" ",r+=i):s=c}this._output_render_context.fillText(s,t,r)}},{key:"detect",value:function(){var e=this;return new Promise(function(){var t=Object(h.a)(d.a.mark((function t(r,i){var n,a,s;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){t.next=26;break}if(t.prev=1,e._is_scanning){t.next=14;break}return t.next=5,navigator.mediaDevices.getUserMedia({video:{width:{ideal:e._output_render_context.canvas.width},height:{ideal:e._output_render_context.canvas.height},facingMode:"environment",frameRate:{ideal:24}}});case 5:e._stream=t.sent,e._video.srcObject=e._stream,null===(n=e._video)||void 0===n||n.play(),e._is_scanning=!0,e._render(),e._read(),r(),t.next=17;break;case 14:a=new Error("Stream already initialised."),e._callbacks.error&&e._callbacks.error(a),i(a);case 17:t.next=24;break;case 19:t.prev=19,t.t0=t.catch(1),e._callbacks.error&&e._callbacks.error(t.t0),e.print("Error. Permission denied. Please update browser permissions to access camera.",e._output_render_context.canvas.width/2,e._output_render_context.canvas.height/2,25),i(t.t0);case 24:t.next=30;break;case 26:s=new Error("Browser does not support getUserMedia."),e._callbacks.error&&e._callbacks.error(s),e.print("Error. Your browser does not support camera access. Use a modern browser or update your browser.",e._output_render_context.canvas.width/2,e._output_render_context.canvas.height/2,25),i(s);case 30:case"end":return t.stop()}}),t,null,[[1,19]])})));return function(e,r){return t.apply(this,arguments)}}())}},{key:"stop",value:function(){var e=this;return new Promise((function(t,r){e._stream&&e._is_scanning?(e._is_scanning=!1,e._video.pause(),e._video.src="",e._stream.getTracks().forEach((function(e){e.stop()})),e.face_cascade.delete(),e.eye_cascade.delete(),e.src.delete(),e.grey.delete(),e.faces.delete(),e.eyes.delete(),e._output_render_context.fillStyle="black",e._output_render_context.fillRect(0,0,e._output_render_context.canvas.width,e._output_render_context.canvas.height),t(!0)):r(new Error("Stream was not initialised."))}))}},{key:"detectFaceData",value:function(){try{if(this._is_ready&&this._is_scanning){var e=this._output_render_context.getImageData(0,0,this._output_render_context.canvas.width,this._output_render_context.canvas.height);this.src=this.cv.matFromImageData(e),this.grey=new this.cv.Mat,this.cv.cvtColor(this.src,this.grey,this.cv.COLOR_RGBA2GRAY,0),this.faces=new this.cv.RectVector,this.eyes=new this.cv.RectVector;var t={},r=new this.cv.Size(0,0);this.face_cascade.detectMultiScale(this.grey,this.faces,1.1,3,0,r,r);for(var i=0;i<this.faces.size();++i){var n=this.grey.roi(this.faces.get(i)),a=this.src.roi(this.faces.get(i)),s=new this.cv.Point(this.faces.get(i).x,this.faces.get(i).y),o=new this.cv.Point(this.faces.get(i).x+this.faces.get(i).width,this.faces.get(i).y+this.faces.get(i).height);t.face={topLeft:s,bottomRight:o},t.eyes=[],this.eye_cascade.detectMultiScale(n,this.eyes);for(var c=0;c<this.eyes.size();++c){var d=new this.cv.Point(this.eyes.get(c).x,this.eyes.get(c).y),h=new this.cv.Point(this.eyes.get(c).x+this.eyes.get(c).width,this.eyes.get(c).y+this.eyes.get(c).height);t.eyes.push({topLeft:d,bottomRight:h})}n.delete(),a.delete()}return t}return this._callbacks.error&&this._callbacks.error(new Error("OpenCV.js is not initalised.")),{}}catch(u){this._callbacks.error&&this._callbacks.error(u)}return{}}}]),r}(function(){function e(){Object(u.a)(this,e),this.cv=void 0,this._is_ready=void 0,this._callbacks={},this.face_cascade=void 0,this.eye_cascade=void 0;this.cv={},this._is_ready=!1,window.cv||function(e,t){f.apply(this,arguments)}({wasm:"./opencv.js"},Object(h.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.cv;case 2:this.cv=e.sent,this._is_ready=!0,this._callbacks.ready&&(this.face_cascade=new this.cv.CascadeClassifier,this.eye_cascade=new this.cv.CascadeClassifier,this.createFileFromUrl("haarcascade_frontalface_default.xml","./haarcascade_frontalface_default.xml",function(){this.face_cascade.load("haarcascade_frontalface_default.xml")}.bind(this)),this.createFileFromUrl("haarcascade_eye.xml","./haarcascade_eye.xml",function(){this.eye_cascade.load("haarcascade_eye.xml")}.bind(this)),this._callbacks.ready());case 5:case"end":return e.stop()}}),e,this)}))).bind(this))}return Object(_.a)(e,[{key:"createFileFromUrl",value:function(e,t,r){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(n){if(4===i.readyState)if(200===i.status){var a=new Uint8Array(i.response);this.cv.FS_createDataFile("/",e,a,!0,!1,!1),r()}else this._callbacks.error&&this._callbacks.error(new Error("Failed to load "+t+" status: "+i.status))}.bind(this),i.send()}},{key:"on",value:function(e,t){switch(e){case"ready":this._callbacks.ready=t;break;case"error":this._callbacks.error=t;break;case"found":this._callbacks.found=t}}}]),e}()),w=r(2),x=function(e){Object(l.a)(r,e);var t=Object(p.a)(r);function r(){var e;Object(u.a)(this,r);for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))).face_detector=void 0,e}return Object(_.a)(r,[{key:"componentDidMount",value:function(){var e=this,t=document.getElementById("canvas").getContext("2d");this.face_detector=new b(t,{border_width:6,border_colour:"red"}),this.face_detector.on("ready",(function(){var t;null===(t=e.face_detector)||void 0===t||t.detect()})),this.face_detector.on("found",(function(e){e.position.face})),this.face_detector.on("error",(function(t){var r;console.error(t),null===(r=e.face_detector)||void 0===r||r.stop()}))}},{key:"render",value:function(){var e=this;return Object(w.jsx)("div",{className:"App",children:Object(w.jsxs)("header",{className:"App-header",children:[Object(w.jsx)("div",{id:"canvas-container",children:Object(w.jsx)("canvas",{id:"canvas",width:"480",height:"852"})}),Object(w.jsx)("button",{onClick:Object(h.a)(d.a.mark((function t(){var r;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,null===(r=e.face_detector)||void 0===r?void 0:r.stop();case 2:case"end":return t.stop()}}),t)}))),children:"Stop"})]})})}}]),r}(a.a.Component),m=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,20)).then((function(t){var r=t.getCLS,i=t.getFID,n=t.getFCP,a=t.getLCP,s=t.getTTFB;r(e),i(e),n(e),a(e),s(e)}))};o.a.render(Object(w.jsx)(a.a.StrictMode,{children:Object(w.jsx)(x,{})}),document.getElementById("root")),m()}},[[19,1,2]]]);
//# sourceMappingURL=main.772851ca.chunk.js.map